<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=1524267501137363&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="container">
	<div class="row">
		<div class="col-md-8">
			<div class="panel panel-default">
				<div class="panel-body">
					<h2>
						<%= @activity.activity_name %>
						<% if @activity.cancelled %>
							<font color='red'>(Cancelled)</font>
						<% end %>
					</h2>
          <% if current_user %>
            <% if @organizer == current_user %>
            <%= link_to 'Edit', activity_edit_path(@activity.id), class: 'btn btn-default pull-right' %>
            <% else %>
            <%= Rsvp.user_rsvp?(@activity, current_user).blank? ? (link_to "Join Us!", rsvp_path(@activity.id, current_user.id), class: 'btn btn-success pull-right') : (link_to "You're Going!", unrsvp_path(@activity.id, current_user.id), class: 'btn btn-danger pull-right') %>
            <% end %>
          <% end %>

					<!-- share buttons -->
					<div class="fb-share-button" data-href="<%= request.original_url %>" data-layout="button_count" style="padding: 0px; vertical-align: top; width: 106px; height: 24px;"></div>

					<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
					<g:plusone></g:plusone>

					<a href="https://twitter.com/share" class="twitter-share-button" data-url="<%= request.original_url %>" data-hashtags="twonoo" data-text="Check out <%= @activity.activity_name %> on TwoNoo!">Tweet</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

					<a href="//www.pinterest.com/pin/create/button/?url=<%= request.original_url %>&description=Check out <%= @activity.activity_name %> on TwoNoo!&media=<%= request.host %>:<%= request.port %><%= @activity.image.url %>" data-pin-do="buttonPin" data-pin-config="beside" data-pin-color="red"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_red_20.png" /></a>

					<!-- Please call pinit.js only once per page -->
					<script type="text/javascript" async src="//assets.pinterest.com/js/pinit.js"></script>

          <div>
            <% @activity.activity_types.each do |a| %>
              <span class="label label-danger"><%= a.activity_type %></span>
            <% end %>
          </div>
          </br>
					<p class="lead"><%= @activity.description %>
</p>
					<p class="lead"><b><%= link_to @activity.location_name, @activity.website %></b></br><%= @activity.datetime.strftime('%A, %B %e, %Y @ %l:%M %p') %></p>
					<div id="map-canvas"></div>
				</div>
			</div>
		</div>

		<div class="col-md-4">
			<div class="panel panel-default">
				<div class="panel-body text-center">
            <%= profile_img(@organizer) %>
            <h4><%= link_to @organizer.profile.first_name + ' ' +  @organizer.profile.last_name, @organizer %></h4> 
            <h4><small><%= @organizer.profile.about_me %></small></h4>
            <% if @organizer != current_user && current_user %>
              <h4><%= current_user.following?(@organizer) ? (link_to 'Unfollow', unfollow_path(@organizer.id), class: 'label label-info') : (link_to 'Follow', follow_path(@organizer.id), class: 'label label-info') %></h4>
	      <div class="text-left">
              Send <%=@organizer.profile.first_name%> a message:
              <%= render '/conversations/form', :organizer => @organizer.email %>
			</div>
            <% end %>
				</div>
			</div>
      <div class="panel panel-default">
        <div class="panel-body">
          <h4>Who's Going (<%=Rsvp.where(activity_id: @activity.id).count%>)</h4>
          <% Rsvp.where(activity_id: @activity.id).each do |rsvp|
            @going = User.find(rsvp.user_id) %>
            <p><%= link_to @going.profile.first_name + ' ' + @going.profile.last_name, @going %></p>
          <% end %>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
          <h4>Activity Comments:</h4>
          <%= render partial: 'comments', locals: {:activity => @activity} %>
          <%= render partial: 'form', locals: {:activity => @activity} %>
        </div>
      </div>
		</div>
  </div>
</div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNhGdKD91B3SVN5kH1oE8y1hS-swp2e4k"></script>

<script type="text/javascript">
  function initialize() {
  	var myLatlng = new google.maps.LatLng(<%= @activity.latitude %>, <%= @activity.longitude %>)

  	var mapOptions = {
  	  center: myLatlng,
  	  zoom: 11, scrollwheel: false
  	};
  	var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

  	var contentString = '<div>'+
  		'<h4><%= @activity.location_name %></h4>' +
  		'<%= @activity.address %></br>' +
      '<%= @activity.datetime.strftime("%A, %B %e, %Y @ %l:%M %p") %>' +
  		'<%= render("activity_img").gsub(/\n/, '').html_safe %>' +
      '</div>';

    var infowindow = new google.maps.InfoWindow({
        content: contentString
    });

    var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: "<%= @activity.activity_name %>"
    });
    google.maps.event.addListenerOnce(map, 'idle', function() {
      infowindow.open(map, marker);
      }
    );
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
      }
    );
  }
  
  google.maps.event.addDomListener(window, 'load', initialize);
</script>

